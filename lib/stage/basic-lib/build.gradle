description = 'StreamSets Data Collector Basic Lib'

dependencies {
  compile project(':core:common')
  compile project(':lib:commonlib')
  compile project(':lib:commonlib')
  compile project(':lib:httpcommonlib')
  compile project(':lib:net-commonlib')
  compile project(':lib:proto:dir-spooler-protolib')
  compile project(':lib:proto:lookup-protolib')
  compile project(':lib:proto:scripting-protolib')
  testCompile project(path: ':lib:commonlib', configuration: 'testArtifacts')
  compile group: 'com.google.guava', name: 'guava', version: '20.0'
  compile group: 'com.jcraft', name: 'jsch', version: '0.1.54'
  compile group: 'com.maxmind.geoip2', name: 'geoip2', version: '2.1.0'
  compile group: 'commons-io', name: 'commons-io', version: '2.4'
  compile group: 'commons-net', name: 'commons-net', version: '3.5'
  compile group: 'io.confluent', name: 'kafka-schema-registry-client', version: '3.0.1'
  compile group: 'io.netty', name: 'netty-handler', version: '4.1.16.Final'
  compile group: 'joda-time', name: 'joda-time', version: '2.8'
  compile group: 'org.apache.avro', name: 'avro', version: '1.8.2'
  compile group: 'org.apache.avro', name: 'avro-compiler', version: '1.8.2'
  compile(group: 'org.apache.avro', name: 'avro-ipc', version: '1.8.2') {
    exclude(module: 'servlet-api')
  }
  compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.4'
  compile group: 'org.apache.commons', name: 'commons-vfs2', version: '2.0'
  compile group: 'org.eclipse.californium', name: 'californium-core', version: '1.0.4'
  compile group: 'org.eclipse.jetty', name: 'jetty-server', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.jetty', name: 'jetty-servlet', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.jetty.websocket', name: 'websocket-api', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.jetty.websocket', name: 'websocket-client', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.jetty.websocket', name: 'websocket-server', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.jetty.websocket', name: 'websocket-servlet', version: '9.4.2.v20170220'
  compile group: 'org.eclipse.milo', name: 'sdk-client', version: '0.1.5'
  compile group: 'org.eclipse.paho', name: 'org.eclipse.paho.client.mqttv3', version: '1.0.2'
  compile group: 'org.glassfish.jersey.connectors', name: 'jersey-grizzly-connector', version: '2.25.1'
  compile(group: 'org.glassfish.jersey.core', name: 'jersey-client', version: '2.25.1') {
    exclude(module: 'javassist')
  }
  compile group: 'org.glassfish.jersey.security', name: 'oauth1-client', version: '2.25.1'
  compile group: 'org.iq80.snappy', name: 'snappy', version: '0.4'
  compile(project(':lib:proto:hdfs-protolib')) {
    exclude(module: 'hadoop-hdfs')
    exclude(module: 'curator-client')
    exclude(module: 'curator-recipes')
    exclude(module: 'zookeeper')
    exclude(module: 'commons-cli')
    exclude(module: 'commons-math3')
    exclude(module: 'commons-net')
    exclude(module: 'zookeeper')
  }
  compile 'org.apache.hadoop:hadoop-client:2.6.0'
  compileOnly group: 'io.dropwizard.metrics', name: 'metrics-core', version: '3.1.2'
  compileOnly group: 'log4j', name: 'log4j', version: '1.2.17'
  compileOnly group: 'org.slf4j', name: 'slf4j-api', version: '1.7.7'
  compileOnly group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.7'
  testCompile project(':core:testing')
  testCompile project(path: ':lib:guavasupport', configuration: 'testArtifacts')
  testCompile project(path: ':lib:net-commonlib', configuration: 'testArtifacts')
  testCompile project(path: ':lib:proto:dir-spooler-protolib', configuration: 'testArtifacts')
  testCompile project(path: ':lib:proto:scripting-protolib', configuration: 'testArtifacts')
  testCompile group: 'com.google.code.gson', name: 'gson', version: '2.2.4'
  testCompile group: 'com.github.fommil', name: 'openssh', version: '1.0'
  testCompile group: 'com.h2database', name: 'h2', version: '1.4.187'
  testCompile group: 'org.apache.sshd', name: 'sshd-core', version: '1.2.0'
  testCompile group: 'org.awaitility', name: 'awaitility', version: '2.0.0'
  testCompile group: 'org.bouncycastle', name: 'bcprov-jdk15on', version: '1.57'
  testCompile(group: 'org.eclipse.milo', name: 'sdk-server', version: '0.1.5') {
    exclude(module: 'javassist')
  }
  testCompile group: 'org.glassfish.jersey.media', name: 'jersey-media-json-jackson', version: '2.25.1'
  testCompile group: 'org.glassfish.jersey.test-framework.providers', name: 'jersey-test-framework-provider-grizzly2', version: '2.25.1'
  testCompile group: 'org.mockftpserver', name: 'MockFtpServer', version: '2.6'
  testCompile group: 'org.powermock', name: 'powermock-api-mockito', version: '1.7.3'
  testCompile group: 'org.powermock', name: 'powermock-module-junit4', version: '1.7.3'
}

apply plugin: "com.commercehub.gradle.plugin.avro"

task convertIdl(type: com.commercehub.gradle.plugin.avro.GenerateAvroProtocolTask) {
  source("src/main/resources/com/streamsets/pipeline/stage/origin/tcp/flumeavroipc")
  outputDir = file("dest/avro")
}

task generateAvro(type: com.commercehub.gradle.plugin.avro.GenerateAvroJavaTask) {
  source(convertIdl.outputs)
  outputDir = file("src/main/java")
}

compileJava.source(generateAvro.outputs)

avro {
  fieldVisibility = "PRIVATE"
}